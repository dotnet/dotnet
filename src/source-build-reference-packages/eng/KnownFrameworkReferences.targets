<Project>

  <!-- Keep in sync with available targeting packs under src/targetPacks/ILsrc. -->
  <ItemGroup Condition="'$(TargetFramework)' != '$(NetCurrent)'">
    <KnownFrameworkReference Update="@(KnownFrameworkReference->WithMetadataValue('Identity', 'Microsoft.NETCore.App'))">
      <TargetingPackVersion Condition="$([System.Text.RegularExpressions.Regex]::IsMatch('%(TargetFramework)', '^net\d+\.0$'))">$([System.Text.RegularExpressions.Regex]::Match('%(TargetFramework)', '\d+').Value).0.0</TargetingPackVersion>
    </KnownFrameworkReference>

    <KnownFrameworkReference Update="@(KnownFrameworkReference->WithMetadataValue('Identity', 'Microsoft.AspNetCore.App'))">
      <TargetingPackVersion Condition="'%(TargetFramework)' == 'net6.0'">6.0.2</TargetingPackVersion>
    </KnownFrameworkReference>
  </ItemGroup>

  <!-- TODO: Make this more general purpose and consider moving into the Arcade SDK into TargetingPacks.targets. This is hacky as it uses newer analyzers from the current framework for downlevel TFMs.
             Necessary as the non-current targeting packs are missing analyzers which result in compiler errors when using i.e. Regex or LibraryImport attributes. -->
  <Target Name="AddAnalyzersForIncompleteTargetingPack"
          AfterTargets="ResolveTargetingPackAssets"
          Condition="'@(FrameworkReference)' != '' and '$(TargetFrameworkIdentifier)' == '.NETCoreApp' and '$(Language)' == 'C#' and '$(TargetFramework)' != '$(NetCurrent)'">
    <ItemGroup>
      <Analyzer Include="$(NetCoreTargetingPackRoot)\Microsoft.NETCore.App.Ref\$(BundledNETCoreAppPackageVersion)\analyzers\dotnet\cs\*.dll" />
    </ItemGroup>
  </Target>

</Project>